machine:
        services:
                - docker
dependencies:
        override: #https://discuss.circleci.com/t/overriding-go-inference-in-the-dependencies-phase/660
                - mkdir -p $HOME/.go_project/src/github.com/$CIRCLE_PROJECT_USERNAME
                - ln -fs $HOME/$CIRCLE_PROJECT_REPONAME $HOME/.go_project/src/github.com/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME
                - echo 'export GOPATH=$GOPATH:$HOME/.go_project' >> ~/.circlerc
                - sudo apt-get install ruby ruby-dev gcc make icnsutils graphicsmagick xz-utils
                  #- go get -d  -v -t ./...
test:
        override:
                - cd desktop && npm install && npm run dist  && cd ..
                  #- ./build_ui.sh
                  #- ./build_docker.sh
                  #- ./build_desktop.sh
                  #
deployment:
        release:
                branch: desktop
                commands:
                        - sleep 10
                        #- go get github.com/tcnksm/ghr
                        #- ghr -t $GITHUB_TOKEN -u $CIRCLE_PROJECT_USERNAME -r $CIRCLE_PROJECT_REPONAME --replace `git describe --tags` desktop/dist/
        hub: 
                branch: master
                commands:
                        - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
                        - ./deploy.sh
