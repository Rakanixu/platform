!function(e){"use strict";var r=e.XP||require("expandjs"),n=require("observe-js").ObjectObserver;module.exports=e.XPObserver=new r.Class("XPObserver",{initialize:function(e,n,t){r.assertArgument(r.isObservable(e),1,"Array, Function or Object"),r.assertArgument(r.isFunction(n),2,"Function");var s=this;return s.value=e,s.callback=n,s.deep=t,s._observers=[],s._addObserver(s.value),s},disconnect:function(){var e=this;return e._removeObserver(e.value),e},_addObserver:{enumerable:!1,value:function(e,t){r.assertArgument(r.isObservable(e),1,"Array, Function or Object"),r.assertArgument(r.isVoid(t)||r.isCollection(t),2,"Array or Object");var s=this,u=function(n){return r.isObservable(n)?s._addObserver(n,e):void 0},i=!s._isObserved(e)&&(!t||r.includesDeep(t,e))&&s._connectObserver(new n(e));return i?(e===s.value?s._observer=i:r.push(s._observers,i),s.deep&&r.isCollection(e)&&r[r.isArray(e)?"forEach":"forOwn"](e,u),s):s}},_connectObserver:{enumerable:!1,value:function(e){r.assertArgument(r.isObject(e),1,"Object");var n=this,t=n._getObserved(e),s=function(e,s,u,i){return r.forEach(e,function(e){return r.isObservable(e)?n._addObserver(e,t):void 0}),r.forEach(u,function(e,s){return r.isObservable(e)?n._removeObserver(i(s))._addObserver(e,t):void 0}),r.forEach(s,function(e,t){return r.isObservable(i(t))?n._removeObserver(i(t)):void 0}),n.callback(n.value)};return e.open(s),e}},_getObserved:{enumerable:!1,value:function(e){return r.assertArgument(r.isObject(e),1,"Object"),e.value_}},_getObserver:{enumerable:!1,value:function(e){return r.assertArgument(r.isObservable(e),1,"Array, Function or Object"),r.find(this._observers,function(r){return r.value_===e})}},_isObserved:{enumerable:!1,value:function(e){return r.assertArgument(r.isObservable(e),1,"Array, Function or Object"),e===this.value?!!this._observer:!!this._getObserver(e)}},_removeObserver:{enumerable:!1,value:function(e){r.assertArgument(r.isObservable(e),1,"Array, Function or Object");var n=this,t=function(e){return r.isObservable(e)?n._removeObserver(e):void 0},s=!r.includesDeep(n.value,e)&&n._getObserver(e);return s?(s.close(),e===n.value?n._observer=s:r.pull(n._observers,s),n.deep&&r.isCollection(e)&&r[r.isArray(e)?"forEach":"forOwn"](e,t),n):n}},callback:{set:function(e){return this.callback||e},validate:function(e){return!r.isFunction(e)&&"Function"}},deep:{set:function(e){return!!e}},value:{set:function(e){return this.value||e},validate:function(e){return!r.isObservable(e)&&"Array, Function or Object"}},_observer:{enumerable:!1,set:function(e){return this._observer||e},validate:function(e){return!r.isObject(e)&&"Object"}},_observers:{enumerable:!1,set:function(e){return this._observers||e},validate:function(e){return!r.isArray(e)&&"Array"}}})}("undefined"!=typeof window?window:global);