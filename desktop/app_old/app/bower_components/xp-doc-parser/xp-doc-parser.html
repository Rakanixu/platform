<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../expandjs/expandjs.html">
<link rel="import" href="../xp-request/xp-request.html">

</head><body><dom-module id="xp-doc-parser">

    <template strip-whitespace="">

        <style>:host{display:none !important;}</style>

        <xp-request url="[[url]]" on-data-changed="_handleData" auto=""></xp-request>

    </template>

    <script>Polymer({is:"xp-doc-parser",parse:function(e){XP.assertArgument(XP.isVoid(e)||XP.isString(e),1,"string");var t=this,r="\\/\\*\\*([\\s\\S]*?)\\*\\/",n="<!--([\\s\\S]*?)-->",a=e?new RegExp(r+"|"+n,"g"):null,i=e?XP.map(XP.match(e,a),function(e){return t.parseBlock(e)}):[],s=e?XP.find(i,function(e){return t.entities.indexOf(e.type)>=0}):null;return s&&t._interpretEntity(s,XP.pull(i,s)),s||{type:"Unknown",name:"Unknown",summary:"**Undocumented**"}},parseBlock:function(e){XP.assertArgument(XP.isVoid(e)||XP.isString(e),1,"string"),e=e||"",e=e.replace(/\r\n/g,"\n"),e=e.replace(/^\s*\/\*\*|^\s*\*\/|^\s*\* ?|^\s*<!-\-|^s*\-\->/gm,"");var t=e.split("\n"),r={};return t=XP.filter(t,function(e){var t=XP.match(e,/^@(\w+)(.*)|^\s+\s+@(\w+)(.*)/);return!t.length||void(r.pragma?r.pragma.push({type:t[1]||t[3],value:XP.clean(t[2]||t[4])||!0}):(r.type=t[1]||t[3],r.name=XP.clean(t[2]||t[4]),r.pragma=[]))}),r.type=r.type||"",r.name=r.name||"",r.summary=XP.trim(t.join("\n")),r},_interpretAdapts:function(e,t){this._interpretDependency(e,t)},_interpretBehavior:function(e,t){this._interpretDependency(e,t)},_interpretDependency:function(e,t){var r=this,n=t.value.split(" ");t.value={name:XP.trim(n[0]),url:XP.trim(n[1])},r._interpretPragma(e,t)},_interpretDevDependency:function(e,t){this._interpretDependency(e,t)},_interpretEntity:function(e,t){XP.assertArgument(XP.isObject(e),1,"Object"),XP.assertArgument(XP.isVoid(t)||XP.isArrayable(t),2,"Arrayable");var r=this,n=XP.withdraw(e,"pragma");XP.forEach(n||[],function(t){XP.apply(r,r._computeInterpreter(t.type)||"_interpretPragma",[e,t])}),XP.forEach(t||[],function(t){XP.apply(r,r._computeInterpreter(t.type)||"_interpretFeature",[e,t])})},_interpretExtends:function(e,t){this._interpretDependency(e,t)},_interpretFeature:function(e,t){XP.assertArgument(XP.isObject(e),1,"Object"),XP.assertArgument(XP.isObject(t),2,"Object");var r=this,n=(t.name||XP.withdraw(t,"name"),XP.withdraw(t,"pragma")),a=XP.withdraw(t,"type"),i=r.plurals[a||""];a&&(XP.forEach(n||[],function(e){XP.apply(r,r._computeInterpreter(e.type)||"_interpretPragma",[t,e])}),i?(e[i]=e[i]||[],e[i].push(t)):e[a]=t)},_interpretKeywords:function(e,t){var r=this;t.value=XP.map(XP.split(t.value,","),function(e){return XP.trim(e)}),r._interpretPragma(e,t)},_interpretParam:function(e,t){var r=this,n=/\{(.+)\}\s+(\[.+\]|\w+\.\w+|\w+)\s*(.*)$/,a=XP.match(t.value,n),i=XP.split(XP.trim(a[2],"[]"),"=",!0),s=XP.split(XP.trim(i[0]),".",!0);t.value={type:XP.trim(a[1]),name:XP.trim(s[s.length>1?1:0]),summary:XP.trim(a[3]),optional:XP.startsWith(a[2],"["),default:XP.trim(i[1])},t.value.optional||delete t.value.optional,t.value.default||delete t.value.default,s.length>1&&(e=XP.findLast(e.params||[],{name:XP.trim(s[0])})||{}),r._interpretPragma(e,t)},_interpretPragma:function(e,t){XP.assertArgument(XP.isObject(e),1,"Object"),XP.assertArgument(XP.isObject(t),2,"Object");var r=this,n=XP.withdraw(t,"type"),a=r.plurals[n||""];a?(e[a]=e[a]||[],e[a].push(t.value)):e[n]=t.value},_interpretReturns:function(e,t){var r=this,n=/\{(.+)\}\s*(.*)$/,a=t.value.match(n)||[];t.value={type:XP.trim(a[1]),summary:XP.trim(a[2])},r._interpretPragma(e,t)},_mergeData:function(e,t){XP.assertArgument(XP.isObject(e),1,"Object"),XP.assertArgument(XP.isArray(t),2,"Array");var r=this;return XP.forEachRight(t,function(t){XP.forEach(r.inheritance,function(r){XP.forEach(t.data[r]||[],function(t){XP.find(e[r]||[],{name:t.name})||(e[r]=e[r]||[],e[r].push(t))})})}),e},_sortData:function(e,t){XP.assertArgument(XP.isObject(e),1,"Object");var r=this;return t&&r.inherited?e:(XP.forEach(r.inheritance,function(t){e[t]&&e[t].sort(function(e,t){return!e.private&&t.private?1:e.private&&!t.private?-1:e.name>t.name?1:e.name<t.name?-1:void 0})}),e)},properties:{data:{notify:!0,observer:"_dataChanged",readOnly:!0,type:Object},empty:{computed:"_computeEmpty(data)",notify:!0,reflectToAttribute:!0,type:Boolean,value:!0},recursive:{type:Boolean,value:!1},url:{type:String}},entities:["behavior","class","element","function","module","object","stylesheet"],inheritance:["attributes","events","methods","properties"],plurals:{attribute:"attributes",behavior:"behaviors",dependency:"dependencies",devDependency:"devDependencies",event:"events",method:"methods",param:"params",property:"properties"},_computeEmpty:function(e){return!e},_computeInterpreter:function(e){var t=this,r="_interpret"+XP.capitalize(e);return XP.isFunction(t[r])?r:void 0},_dataChanged:function(){this.data&&this.fire("xp-doc-parse",{firer:this,data:this.data})},created:function(){this.classList.add("parser")},_handleData:function(e){var t=this,r=e.detail.value&&t.parse(e.detail.value)||null,n=0,a=null,i=[];t.recursive&&r&&r.extends&&r.extends.url&&(a=document.createElement("xp-doc-parser"),a.addEventListener("xp-doc-parse",function(){(n+=1)===i.length&&t._setData(t._sortData(t._mergeData(r,i),!0))}),i.push(XP.assign(a,{inherited:!0,recursive:!0,url:r.extends.url}))),t.recursive&&r&&r.behaviors&&r.behaviors.forEach(function(e){e.url&&(a=document.createElement("xp-doc-parser"),a.addEventListener("xp-doc-parse",function(){(n+=1)===i.length&&t._setData(t._sortData(t._mergeData(r,i),!0))}),i.push(XP.assign(a,{inherited:!0,recursive:!0,url:e.url})))}),i.length||t._setData(r&&t._sortData(r,!0))}});</script>

</dom-module>
</body></html>