<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../expandjs/expandjs.html">
<link rel="import" href="xp-markdown-styles.html">

<script src="../prism/prism.js"></script>
<script src="../markdown-it/dist/markdown-it.min.js"></script>

</head><body><dom-module id="xp-markdown">

    <template strip-whitespace="">

        <style include="xp-markdown-styles"></style>

        <style>:host{display:block;}:host([empty]){display:none !important;}:host ::content p > code{background:hsla(24, 20%, 95%, 1);padding:0 4px;}:host ::content pre{background:hsla(24, 20%, 95%, 1);font-size:14px;font-weight:400;letter-spacing:0.01em;line-height:20px;overflow-x:scroll;overflow-y:auto;padding:16px 24px;}</style>

        <content></content>

    </template>

    <script>Polymer({is:"xp-markdown",_detect:function(e,t){return t?"js"===t||"es"===t.substr(0,2)?Prism.languages.javascript:"css"===t?Prism.languages.css:"c"===t?Prism.languages.clike:Prism.languages.markup:e.match(/^\s*</)?Prism.languages.markup:Prism.languages.javascript},observers:["_codeChanged(code, parser)","_parserChanged(breaks, html, linkify, quotes, typographer, xhtmlOut)"],listeners:{click:"_handleClick"},properties:{breaks:{type:Boolean,value:!1},code:{notify:!0,type:String},empty:{computed:"_computeEmpty(source)",notify:!0,reflectToAttribute:!0,type:Boolean,value:!0},html:{type:Boolean,value:!1},linkify:{type:Boolean,value:!1},parser:{notify:!0,readOnly:!0},quotes:{type:String,value:"“”‘’"},source:{notify:!0,observer:"_sourceChanged",readOnly:!0,type:String},typographer:{type:Boolean,value:!1},wrapper:{notify:!0,readOnly:!0},xhtmlOut:{type:Boolean,value:!1}},_computeEmpty:function(e){return!e},_codeChanged:function(){this.parser&&this._setSource(this.parser.render(this.code||""))},_parserChanged:function(){var e=this,t=markdownit({breaks:e.breaks,highlight:function(t,r){return Prism.highlight(t,e._detect(t,r))},html:e.html,linkify:e.linkify,quotes:e.quotes,typographer:e.typographer,xhtmlOut:e.xhtmlOut});t.core.ruler.push("heading_anchors",function(e){for(var t=0;t<e.tokens.length-1;t+=1)if("heading_open"===e.tokens[t].type&&"inline"===e.tokens[t+1].type&&e.tokens[t+1].content){var r=e.tokens[t+1].content.replace(/ /g,"");e.tokens[t].attrPush(["id",r]);var n=new e.Token("html_inline","",0);n.content='<a href="#" name="'+r+'"></a>',e.tokens[t+1].children.unshift(n),t+=2}}),e._setParser(t)},_sourceChanged:function(){this.isAttached&&(Polymer.dom(this).innerHTML=this.source||"")},attached:function(){var e=this,t=e.source;e.code=e.code||Polymer.dom(e).innerHTML,e.source===t&&e._sourceChanged()},created:function(){this.classList.add("markdown")},_handleClick:function(e){if(!e.button){var t=this,r=Polymer.dom(e).rootTarget,n="A"===r.tagName?r:XP.findParentElement(r,"a",t);n&&n.href&&t.fire("xp-redirect",{firer:t,anchor:n,href:n.href},{cancelable:!0}).defaultPrevented&&e.preventDefault()}}});</script>

</dom-module>
</body></html>