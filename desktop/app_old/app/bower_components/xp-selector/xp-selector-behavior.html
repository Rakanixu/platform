<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../expandjs/expandjs.html">
<link rel="import" href="../xp-array-behavior/xp-array-behavior.html">
<link rel="import" href="../xp-finder-behavior/xp-finder-behavior.html">
<link rel="import" href="../xp-targeter-behavior/xp-targeter-behavior.html">

<script>Polymer.XPSelectorBehaviorImp={isSelectable:function(e,t){var i=this,l=i.findItem(e,t);return!!i.items&&i.items.indexOf(l)>=0&&!i.isSelected(l)},isSelected:function(e,t){var i=this,l=i.findItem(e,t);return i.multi?i.selection.indexOf(l)>=0:i.selection===l},isUnselectable:function(e,t,i){var l=this,n=l.findItem(e,i);return!!l.items&&l.items.indexOf(n)>=0&&l.isSelected(n)&&(!!t||l.multi||l.switchable)},select:function(e,t){var i=this,l=i.findItem(e,t),n=i.findIndex(l,!0);return l&&i.isSelectable(l)?i.fire("xp-select",{firer:i,item:l,index:n,isMulti:i.multi,isSelected:!0,isSwitchable:i.multi||i.switchable,data:l.data},{cancelable:!0}).defaultPrevented?null:(i._setSelecting(!0),i.multi?i.append("selection",l):i._setSelection(l),i.multi?i.append("selected",n):i.selected=n,i._setSelecting(!1),l):null},selectAll:function(e){var t=this;return t.multi?XP.map(t.findItems(e),function(e){return t.select(e,!0)}):[]},selectNext:function(){var e=this;return e.multi?null:e.select(XP.getNext(e.items||[],e.selection),!0)},selectPrevious:function(){var e=this;return e.multi?null:e.select(XP.getPrevious(e.items||[],e.selection),!0)},switch:function(e,t,i){var l=this,n=l.findItem(e,i);return n?l.isSelected(n)?l.unselect(n,t,!0):l.select(n,!0):null},unselect:function(e,t,i){var l=this,n=l.findItem(e,i),s=l.findIndex(n,!0);return n&&l.isUnselectable(n,t)?l.fire("xp-select",{firer:l,item:n,index:s,isMulti:l.multi,isSelected:!1,isSwitchable:l.multi||l.switchable,data:n.data},{cancelable:!t}).defaultPrevented?null:(l._setSelecting(!0),l.multi?l.pull("selection",n):l._setSelection(null),l.multi?l.pull("selected",s):l.selected=null,l._setSelecting(!1),n):null},unselectAll:function(e,t){var i=this;return i.multi||i.switchable||t?XP.map(i.findItems(e),function(e){return i.unselect(e,t,!0)}):[]},resetSelection:function(){var e=this;return e.unselectAll(null,!0),e},listeners:{click:"_switchHandler"},observers:["_initializedObserver(initialized)","_selectedObserver(selected.*)","_selectionObserver(selection.*)"],properties:{defaultSelected:{},emptySelection:{computed:"_computeEmptySelection(selection.*)",notify:!0,reflectToAttribute:!0,type:Boolean,value:!0},itemSelector:{type:String,value:".selectable"},selectable:{observer:"_selectableObserver",reflectToAttribute:!0,type:Boolean,value:!1},selected:{notify:!0},selectedAttribute:{type:String,value:"active"},selectedData:{notify:!0,readOnly:!0},selecting:{notify:!0,readOnly:!0,type:Boolean,value:!1},selection:{notify:!0,readOnly:!0},switchable:{notify:!0,reflectToAttribute:!0,type:Boolean,value:!1}},_computeEmptySelection:function(){return!this.selection||XP.isArray(this.selection,!1)},_initializedObserver:function(){var e=this;if(e.initialized)return XP.isInput(e.defaultSelected)?void e.select(e.indexAttribute?e.defaultSelected:XP.toIndex(e.defaultSelected,!0)):void(XP.isInput(e.selected)&&e.select(e.selected))},_itemsObserver:function(){var e=this;Polymer.XPFinderBehaviorImp._itemsObserver.apply(e,arguments),e.initialized&&(e._setSelecting(!0),e.multi?e.overwrite("selection",XP.intersection(e.items||[],e.selection)):e._setSelection(e.findItem(e.selection)),e.multi?e.overwrite("selected",XP.map(e.selection,function(t){return e.findIndex(t,!0)})):e.selected=e.findIndex(e.selection,!0),e._setSelecting(!1))},_selectableObserver:function(){this.selectable||this.unselectAll(null,!0)},_selectedObserver:function(){var e=this,t=e.findTarget();!e.selecting&&e.multi&&e.overwrite("selection",XP.map(e.selected,function(t){return e.findItem(t)})),e.selecting||e.multi||e._setSelection(XP.isInput(e.selected)&&e.findItem(e.selected)||null),t&&(t.selected=e.selected)},_selectionObserver:function(){var e=this;e._setSelectedData(e.selection&&!e.multi?XP.toDefined(e.selection.data):null),e.items&&e.items.forEach(function(t){XP.setAttribute(t,e.selectedAttribute,e.isSelected(t,!0))}),e.fire("xp-selection",{firer:e,selection:e.selection,selected:e.selected,isMulti:e.multi,isSwitchable:e.multi||e.switchable})},created:function(){this.classList.add("selector")},_switchHandler:function(e){if(!e.button&&!e.selectPrevented&&this.selectable){var t=this,i=Polymer.dom(e).rootTarget,l=t.findItem(i)||t.findItem(XP.findParentElement(i,t.itemSelector,t));l&&t.switch(l,!1,!0),l&&l.href&&"A"===l.tagName&&t.fire("xp-redirect",{firer:t,anchor:l,href:l.href},{cancelable:!0}).defaultPrevented&&e.preventDefault()}}},Polymer.XPSelectorBehavior=[Polymer.XPArrayBehavior,Polymer.XPFinderBehavior,Polymer.XPTargeterBehavior,Polymer.XPSelectorBehaviorImp];</script>
</head><body></body></html>