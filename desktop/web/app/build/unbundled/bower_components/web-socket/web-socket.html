<html><head><link rel="import" href="../polymer/polymer.html">



<script>Polymer({is:"web-socket",properties:{url:{type:String,observer:"_urlChanged"},protocols:{type:Array,value:[]},json:{type:Boolean,value:!1},auto:{type:Boolean,value:!1},_reopenInterval:{type:Number,value:100}},attached:function(){this.auto&&this.open()},detached:function(){this.close()},open:function(){if(!this.url)throw Error("url property is required");this._websocket=new WebSocket(this.url,this.protocols),this._websocket.onopen=this._onOpen.bind(this),this._websocket.onclose=this._onClose.bind(this),this._websocket.onmessage=this._onMessage.bind(this),this._websocket.onerror=this._onError.bind(this)},close:function(){this._websocket&&(this._websocket.close(),this._websocket=null)},send:function(e){this._websocket&&(this.json&&null!==e&&"object"==typeof e&&(e=JSON.stringify(e)),this._websocket.send(e))},_onOpen:function(){this._reopenInterval=this._config._reopenInterval,this.cancelAsync(this._reopenAttempt),this.fire("open")},_onClose:function(e){e.wasClean||(this._reopenAttempt=this.async(this.open,this._reopenInterval),this._reopenInterval*=2),this.fire("close")},_onMessage:function(e){if(this._websocket){var t=e.data;if(this.json&&"string"==typeof t||t instanceof String)try{t=JSON.parse(t)}catch(e){this.fire("error",e)}this.fire("message",t)}},_onError:function(e){this.fire("error",e)},_urlChanged:function(e){this.auto&&(this.close(),this.open())}});</script>
</head><body></body></html>