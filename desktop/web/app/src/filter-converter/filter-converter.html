/**
* This element manages the `filters` query parameter.
*
*/
<dom-module id="filter-converter">
  <script>
    (function () {
      Polymer({
        is: 'filter-converter',
        behaviors: [
          Polymer.UtilBehaviorImp
        ],
        properties: {
          filters: {
            type: Object,
            notify: true,
            value: function() {
              return {};
            }
          }
        },
        setValue: function(filterType, val) {
          this.set('filters.' + filterType, val);
          this.fireFilterChanged();
        },
        setValues: function(obj) {
          _.forEach(obj, function(val, attr) {
            this.set('filters.' + attr, val);
          }.bind(this));

          this.fireFilterChanged();
        },
        getFilterAsObj: function() {
          return this.filters;
        },
        getFilterAsElasticQuery: function() {
          // For quering Elastic API
          var query = {
            from: this.filters.from || 0,
            size: this.filters.size || 20,
            query: {
              bool: {
                should: [
                  this._getCategory(),
                  this._getQueryTerm()
                ]
              }
            }
          };

          return query;
        },
        getFilterAsElasticQueryString: function() {
          // For quering Elastic service directly (No API)
          return JSON.stringify(this.getFilterAsElasticQuery());
        },
        fireFilterChanged: function (newVal, oldVal) {
          this.fire('filter-changed', {});
        },
        _getCategory: function() {
          var match = {};

          if (this.filters.category) {
            match = {
              match: {
                category: this.filters.category
              }
            };
          }

          return match;
        },
        _getQueryTerm: function() {
          var match = {};

          if (this.filters.q) {
            match = {
              match: {
                name: this.filters.q
              }
            };
          }

          return match;
        }
      });
    }());
  </script>
</dom-module>
