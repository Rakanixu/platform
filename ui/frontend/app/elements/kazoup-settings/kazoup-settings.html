<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../kazoup-settings-configuration/kazoup-settings-configuration.html">
<link rel="import" href="../kazoup-settings-data-sources/kazoup-settings-data-sources.html">
<link rel="import" href="../kazoup-settings-policies/kazoup-settings-policies.html">
<link rel="import" href="../kazoup-settings-users/kazoup-settings-users.html">

<dom-module id="kazoup-settings">so
  <link rel="import" type="css" href="kazoup-settings.css">

  <template>
    <paper-toolbar class="medium-tall">
      <paper-icon-button icon="menu" on-tap="openDrawerPanel" paper-drawer-toggle></paper-icon-button>
      <div class="title">Settings</div>

      <paper-tabs class="middle horizontal layout" selected="{{selectedTab}}" scrollable>
        <paper-tab class="flex">CONFIGURATION</paper-tab>
        <paper-tab class="flex">DATA SOURCES</paper-tab>
        <paper-tab class="flex">ARCHIVE POLICIES</paper-tab>
        <paper-tab class="flex">USERS</paper-tab>
      </paper-tabs>
    </paper-toolbar>

    <div class="container box vertical layout center-justified">
      <neon-animated-pages id="neonPages"
                           entry-animation="fade-in-animation"
                           exit-animation="fade-out-animation"
                           selected="{{selectedTab}}">
        <neon-animatable>
          <kazoup-settings-configuration></kazoup-settings-configuration>
        </neon-animatable>

        <neon-animatable>
          <kazoup-settings-data-sources></kazoup-settings-data-sources>
        </neon-animatable>

        <neon-animatable>
          <kazoup-settings-policies></kazoup-settings-policies>
        </neon-animatable>

        <neon-animatable>
          <kazoup-settings-users></kazoup-settings-users>
        </neon-animatable>
      </neon-animated-pages>
    </div>


  </template>
  <script>
    'use strict';

    (function() {
      Polymer({
        is: 'kazoup-settings',
        behaviors: [
          KazoupBehaviors.PanelActions,
          KazoupBehaviors.Routing
        ],
        properties: {
          selectedTab: {
            type: Number,
            notify: false,
            observer: 'selectedTabChanged'
          },
          sections: {
            type: Array,
            notify: false,
            value: function() {
              return [
                'conf',
                'sources',
                'policies',
                'users'
              ];
            }
          }
        },
        selectedTabChanged: function(newVal, oldVal) {
          if (oldVal !== undefined) {
            history.replaceState(
              {},
              'Settings',
              location.origin + '/settings?section=' + this.sections[this.selectedTab]
            );
          }

          switch (this.selectedTab) {
            case 0:
              Kazoup.SharedData.fireEvent('kazoup-settings-configuration-initialized', {});
              break;
            case 1:
              Kazoup.SharedData.fireEvent('kazoup-settings-data-sources-initialized', {});
              break;
            case 2:
              Kazoup.SharedData.fireEvent('kazoup-settings-policies-initialized', {});
              break;
            case 3:
              Kazoup.SharedData.fireEvent('kazoup-settings-users-initialized', {});
              break;
          }
        },
        init: function(e) {
          if (e && e.section) {
            if (this.sections.indexOf(e.section) !== -1) {
              this.selectedTab = this.sections.indexOf(e.section);
            }
          } else {
            this.selectedTab = 0;
            history.replaceState(
              {},
              'Settings',
              location.href + '?section=conf'
            );
          }
        },
        attached: function() {
          Polymer.dom.flush();

          // kazoup-settings initialized with URL params
          window.addEventListener('WebComponentsReady', function() {
            this.init(this.parseQueryString(window.location.search));
          }.bind(this));
        }
      });
    }());
  </script>
</dom-module>
