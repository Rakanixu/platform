<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>kazoup-file-preview</title>

  <script src="/app/bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
  <script src="/app/bower_components/web-component-tester/browser.js"></script>

  <!-- Tests dependencies -->
  <script src="/app/scripts/kazoup-shared-data.js"></script>
  <script src="/app/bower_components/qwest/qwest.min.js"></script>
  <link rel="import" href="../behaviors/behaviors.html">
  <link rel="import" href="../elements/kazoup-file-preview/kazoup-file-preview.html">

</head>
<body>

<kazoup-file-preview id="fixture"></kazoup-file-preview>

<script>
  suite('<kazoup-file-preview>', function() {
    var el = document.querySelector('#fixture');

    el.searchResultsDetails = {"_score":1,"_type":"file","_id":"//10.17.57.20/Managed Services/Clients/Colo/1 -CANCELLED or ARCHIVED/Chaucer/Quote_QT_642845.pdf:1301479769000","_source":{"content":{"content_time":6.010873,"tika_metadata":"\"access_permission:assemble_document\",\"true\"\n\"access_permission:extract_for_accessibility\",\"true\"\n\"pdf:PDFVersion\",\"1.2\"\n\"access_permission:can_modify\",\"true\"\n\"X-Parsed-By\",\"org.apache.tika.parser.DefaultParser\",\"org.apache.tika.parser.pdf.PDFParser\"\n\"access_permission:modify_annotations\",\"true\"\n\"access_permission:can_print_degraded\",\"true\"\n\"xmpTPg:NPages\",\"2\"\n\"pdf:encrypted\",\"false\"\n\"access_permission:extract_content\",\"true\"\n\"access_permission:fill_in_form\",\"true\"\n\"dc:format\",\"application/pdf; version=1.2\"\n\"access_permission:can_print\",\"true\"\n\"Content-Type\",\"application/pdf\"\n","unique":true,"content_stored":true,"money":{"count":0,"value":[]},"organisation":{"count":0,"value":[]},"percent":{"count":0,"value":[]},"person":{"count":0,"value":[]},"text":"'\\nConfigurations \\n\\nWhilst every care has been taken to ensure that the contents of this proposal are correct and realistic, the recommendations for equipment, programs and services are based on the information we have been given, our own observations \\nand our experience. We believe that these recommendations are sound, but the degree of success with which equipment, software and other services can be applied to data processing and meeting your requirements as set out in this \\nproposal, is dependent upon many factors not under our control. Our recommendations for equipment, software and services together with estimates of performance and results must not be regarded as express or implied warranties. If \\n\\nthis proposal has been based on sizing performed by you or a third party) and therefore not verified by SCC, we cannot provide any estimates of performance and results.  \\n\\nSales Quotation\\nDate Prepared 30/03/2011\\nFAO MR Peter Groucutt\\nCustomer DataBarracks Ltd\\nAccount D7522\\nTel 07876 500727\\nEmail Peter.Groucutt@databarracks.com\\nRef Netapp FAS3210A v2\\n\\nOur Ref QT-642845 v1\\nFrom Kelly Chance\\nTel 0845 351 0977\\nFax 0121 766 2698\\nEmail kelly.chance@scc.com\\nPricing Valid To 30/03/2011\\n\\nSpecialist Computer Centres PLC\\nVantage Point, Langley Business Centre\\n\\nStation Road\\nLangley\\n\\nSL3 8YR\\n\\nManufacturer Part Description Qty Price Total\\nDOC-32XX-C Documents,32XX,-C 1 \\xc2\\xa3 .00 \\xc2\\xa3 .00\\nDS2246-1014-24S-R5-C DSK SHLF,24x600GB,10K,6Gb SAS,IOM6,-C,R5 2 \\xc2\\xa3 18,068.07 \\xc2\\xa3 36,136.14\\nDS4243-0748-24A-R5-C DSK SHLF,24x2.0TB,7.2K,SATA,IOM3,-C,R5 2 \\xc2\\xa3 17,777.94 \\xc2\\xa3 35,555.88\\nFAS-V32XX-CHASSIS-R6 FAS/V32XX,Chassis,AC PS,-C,R6 1 \\xc2\\xa3 .00 \\xc2\\xa3 .00\\nFAS3210A-IB-BASE-R6 FAS3210 HA System with Dual Cntrlr 2 \\xc2\\xa3 2,490.16 \\xc2\\xa3 4,980.32\\nX-SFP-H10GB-CU1M-R6- Cisco N50XX 10GBase Copper SFP+cable,1m,-C,R6 2 \\xc2\\xa3 60.00 \\xc2\\xa3 120.00\\nX2065A-R6-C HBA SAS 4-Port Copper 3/6 Gb QSFP PCIe,-C 4 \\xc2\\xa3 447.63 \\xc2\\xa3 1,790.52\\nX6558-R6-C Cable,SAS Cntlr-Shelf/Shelf-Shelf/HA,2m,-C 8 \\xc2\\xa3 29.52 \\xc2\\xa3 236.16\\nX6559-R6-C Cable,SAS Cntlr-Shelf/Shelf-Shelf/HA,5m,-C 8 \\xc2\\xa3 40.45 \\xc2\\xa3 323.60\\nX6561-R6-C Cable,Ethernet,2m RJ45 CAT6,-C 1 \\xc2\\xa3 .00 \\xc2\\xa3 .00\\nX6562-R6-C Cable,Ethernet,5m RJ45 CAT6,-C 8 \\xc2\\xa3 .00 \\xc2\\xa3 .00\\nX800-42U-R6-C Cabinet Component Power Cable,-C,R6 10 \\xc2\\xa3 .00 \\xc2\\xa3 .00\\nX870C-R6-C Cab,Deep,Empty,No PDU,No Rails,-C 1 \\xc2\\xa3 841.88 \\xc2\\xa3 841.88\\nX8712C-R6-C PDU,1-Phase,12 Outlet,30A,NEMA,-C,R6 4 \\xc2\\xa3 130.32 \\xc2\\xa3 521.28\\nX8778-R6-C Mounting Bracket,Tie-Down,32X0,-C,R6 1 \\xc2\\xa3 11.94 \\xc2\\xa3 11.94\\nX877B-R6-C Rail Kit II, Cab,-C,R6 5 \\xc2\\xa3 .00 \\xc2\\xa3 .00\\nSW-3210A-NFS-C SW,NFS,3210A,-C 2 \\xc2\\xa3 2,359.85 \\xc2\\xa3 4,719.70\\nSW-3210A-ONTAP8-C SW,Data ONTAP Essentials,3210A,-C 2 \\xc2\\xa3 .00 \\xc2\\xa3 .00\\nSW-CIFS-C SW,CIFS,-C 2 \\xc2\\xa3 .00 \\xc2\\xa3 .00\\nCS-A2-INST-4R SupportEdge Standard Part Replace 4hr,Install - Mths:36 1 \\xc2\\xa3 29,912.04 \\xc2\\xa3 29,912.04\\n\\n \\n\\nTotal ex. VAT \\xc2\\xa3 115,149.46\\nVAT \\xc2\\xa3 23,029.89\\nTotal inc. VAT \\xc2\\xa3 138,179.35\\n\\nPage 1 of 2\\n\\n\\n\\nWhere quoted a day shall comprise seven (7) hours between 9.00am and 5.00pm. Any excessive travelling will be included in quotations within the working day. All expenses are included in the daily rate.  \\n\\nValue added tax is not included in the schedule of prices, unless specifically identified as such. As the rate of the value added tax can be altered by Government Order at short notice, any changes so produced shall be incorporated in \\nto invoices immediately those changes take legal effect. \\n\\nAll business is subject to SCC standard Terms and Conditions unless otherwise agreed in writing. \\nThis proposal is confidential and must not be disclosed to any third party without prior written permission by the company  \\n\\nThis proposal shall expire in seven days, subject to change caused by currency fluctuation. \\n\\nSCC will invoice 30 days prior to the contract expiry unless notified otherwise. \\nAll prices exclude VAT & OE \\n\\nPage 2 of","location":{"count":0,"value":[]},"time":{"count":0,"value":[]},"date":{"count":0,"value":[]},"checksum":"a6756c4d5483de0629fc66322cf77fb438e1f639db5f65236319ef2991f73948","checksum_time":0.00078},"exists_on_disk":true,"_id":"//10.17.57.20/Managed Services/Clients/Colo/1 -CANCELLED or ARCHIVED/Chaucer/Quote_QT_642845.pdf:1301479769000","archive_complete":null,"first_seen":"2015-12-18T10:13:00.718546+00:00","metadata":{"mimetype":"application/pdf","doc_type":"PDF Files","dirpath_split":{"0":"//10.17.57.20","1":"//10.17.57.20/Managed Services","2":"//10.17.57.20/Managed Services/Clients","3":"//10.17.57.20/Managed Services/Clients/Colo","4":"//10.17.57.20/Managed Services/Clients/Colo/1 -CANCELLED or ARCHIVED","5":"//10.17.57.20/Managed Services/Clients/Colo/1 -CANCELLED or ARCHIVED/Chaucer"},"uid":0,"extension":".pdf","created":"2015-02-04T18:39:29+00:00","smb_attributes":{"extended_attributes":32,"created":"Thu Jan 26 09:11:19 PM 2012 UTC","last_attr_change":"Wed Feb  4 06:39:29 PM 2015 UTC","last_write":"Wed Mar 30 10:09:29 AM 2011 UTC","last_access":"Wed Feb  4 06:39:29 PM 2015 UTC","offline":false},"modified":"2011-03-30T10:09:29+00:00","filename":"Quote_QT_642845.pdf","gid":0,"dirpath":"//10.17.57.20/Managed Services/Clients/Colo/1 -CANCELLED or ARCHIVED/Chaucer/","accessed":"2015-02-04T18:39:29+00:00","fullpath":"//10.17.57.20/Managed Services/Clients/Colo/1 -CANCELLED or ARCHIVED/Chaucer/Quote_QT_642845.pdf","sharepath":"//10.17.57.20/Managed Services/","filename_b64":"UXVvdGVfUVRfNjQyODQ1LnBkZg==","size":11040},"id_b64":"Ly8xMC4xNy41Ny4yMC9NYW5hZ2VkIFNlcnZpY2VzL0NsaWVudHMvQ29sby8xIC1DQU5DRUxMRUQgb3IgQVJDSElWRUQvQ2hhdWNlci9RdW90ZV9RVF82NDI4NDUucGRmOjEzMDE0Nzk3NjkwMDA=","permissions":{"deny":[],"access_users":[],"acl_error":"","acl":"REVISION:1,OWNER:S-1-5-32-544,GROUP:S-1-5-21-514254323-1285990844-3399610498-513,ACL:S-1-5-32-544:0/0/0x001f01ff,ACL:S-1-5-18:0/0/0x001f01ff,ACL:S-1-5-32-544:0/0/0x001f01ff,ACL:S-1-5-32-545:0/0/0x001200a9","access_groups":["builtin\\administrators","nt authority\\system","builtin\\administrators","builtin\\users"],"allow":["builtin\\administrators","nt authority\\system","builtin\\administrators","builtin\\users"]},"last_seen":"2016-04-22T01:30:08.656561+00:00"},"_index":"files_v2","highlight":"","id_b64":"JTJGJTJGMTAuMTcuNTcuMjAlMkZNYW5hZ2VkJTIwU2VydmljZXMlMkZDbGllbnRzJTJGQ29sbyUyRjElMjAtQ0FOQ0VMTEVEJTIwb3IlMjBBUkNISVZFRCUyRkNoYXVjZXIlMkZRdW90ZV9RVF82NDI4NDUucGRmJTNBMTMwMTQ3OTc2OTAwMA==","color":"#ff7f0e","numberOfDuplicates":1};

    suite('searchResultsDetailsChanged', function() {
      setup(function() {
        sinon.spy(el, 'deviceLayout');
        sinon.stub(qwest, 'map', function() {
          return {
            catch: function() {}
          };
        });
      });

      teardown(function() {
        el.deviceLayout.restore();
        qwest.map.restore();
      });

      suite('when appliance is demo', function() {
        test('should show demo file', function() {
          Kazoup.SharedData.config.APPLIANCE_IS_DEMO = true;
          el.searchResultsDetailsChanged();

          assert(el.deviceLayout.calledOnce);
          assert(qwest.map.notCalled);
          assert.notEqual(el.fileURL.indexOf('amazonaws'), -1);
        });
      });

      suite('when appliance is not demo', function() {
        test('should show real file', function() {
          Kazoup.SharedData.config.APPLIANCE_IS_DEMO = false;
          el.searchResultsDetailsChanged();

          assert(el.deviceLayout.calledOnce);
          assert(qwest.map.calledOnce);
          assert.notEqual(el.fileURL.indexOf(el.searchResultsDetails.id_b64), -1);
        });
      });
    });

    suite('deviceLayout', function() {
      suite('', function() {
        setup(function() {
          sinon.stub(el, 'isMobileDevice', function() {
            return {
              any: function() {
                return true;
              }
            };
          });
        });

        teardown(function() {
          el.isMobileDevice.restore();
        });

        test('should set mobile device layout', function() {
          el.deviceLayout();

          assert.equal(el.mobileLayout, true);
          assert.equal(el.toolbarClass, 'mobile');
          assert.equal(el.containerClass, 'mobile');
        });
      });

      suite('', function() {
        setup(function() {
          sinon.stub(el, 'isMobileDevice', function() {
            return {
              any: function() {
                return false;
              }
            };
          });
        });

        teardown(function() {
          el.isMobileDevice.restore();
        });

        test('should set desktop layout', function() {
          el.deviceLayout();

          assert.equal(el.mobileLayout, false);
          assert.equal(el.toolbarClass, 'medium-tall desktop');
          assert.equal(el.containerClass, 'desktop');
        });
      });
    });

    suite('goBack', function() {
      test('should go back to search view', function() {
        el.goBack();

        assert.equal(el.selected, 0);
      });
    });

    suite('downloadFile', function() {
      var mock;

      suite('', function() {
        setup(function() {
          mock = sinon.mock(window);
          mock.expects('open').withArgs(el.fileURL + '?archive=true', '_blank');

          sinon.stub(Polymer, 'dom', function() {
            return {
              querySelector: function() {
                return {
                  text: '',
                  show: function() {}
                }
              }
            }
          });
        });

        teardown(function() {
          window.open.restore();
          Polymer.dom.restore();
        });

        test('should kick off download from archive', function() {
          el.downloadFile({
            detail: {
              sourceEvent: {
                ctrlKey: true
              }
            }
          });
        });
      });

      suite('', function() {
        setup(function() {
          mock = sinon.mock(window);
          mock.expects('open').withArgs(el.fileURL, '_blank');
        });

        teardown(function() {
          window.open.restore();
        });

        test('should kick off download from local', function() {
          el.downloadFile({
            detail: {
              sourceEvent: {
                ctrlKey: false
              }
            }
          });
        });
      });
    });

    suite('toggleDetailsPanel', function() {
      var add, remove;

      suite('', function() {
        setup(function() {
          add = sinon.spy();
          remove = sinon.spy();

          sinon.stub(Polymer, 'dom', function() {
            return {
              querySelector: function() {
                return {
                  classList: {
                    contains: function() {
                      return true;
                    },
                    add: add,
                    remove: remove
                  }
                }
              }
            }
          });
        });

        teardown(function() {
          Polymer.dom.restore();
        });

        test('should close details panel', function() {
          el.toggleDetailsPanel();

          assert(add.notCalled);
          assert(remove.calledOnce);
        });
      });

      suite('', function() {
        setup(function() {
          add = sinon.spy();
          remove = sinon.spy();

          sinon.stub(Polymer, 'dom', function() {
            return {
              querySelector: function() {
                return {
                  classList: {
                    contains: function() {
                      return false;
                    },
                    add: add,
                    remove: remove
                  }
                }
              }
            }
          });
        });

        teardown(function() {
          Polymer.dom.restore();
        });

        test('should open details panel', function() {
          el.toggleDetailsPanel();

          assert(add.calledOnce);
          assert(remove.notCalled);
        });
      });
    });


    suite('setChecksum', function() {
      var setCheckumSearch = sinon.spy();

      setup(function() {
        sinon.spy(el, 'goBack');
        sinon.stub(Polymer, 'dom', function() {
          return {
            querySelector: function() {
              return {
                setCheckumSearch: setCheckumSearch
              }
            }
          }
        });
      });

      teardown(function() {
        el.goBack.restore();
        Polymer.dom.restore();
      });

      test('should set a checksum and set search view', function() {
        el.setChecksum();

        assert(setCheckumSearch.calledOnce);
        assert(el.goBack.calledOnce);
      })
    });

    suite('copyTextToClipboard', function() {
      var show, removeChild, appendChild;
      setup(function() {
        show = sinon.spy();
        removeChild = sinon.spy();
        appendChild = sinon.spy();

        sinon.spy(document, 'execCommand');

        sinon.stub(Polymer, 'dom', function() {
          return {
            querySelector: function() {
              return {
                text: '',
                show: show
              }
            },
            appendChild: appendChild,
            removeChild: removeChild
          }
        });
      });

      teardown(function() {
        document.execCommand.restore();
        Polymer.dom.restore();
      });

      test('should copy path to clipboard', function() {
        el.copyTextToClipboard();

        assert(document.execCommand.calledOnce);
        assert(show.calledOnce);
        assert(removeChild.calledOnce);
        assert(appendChild.calledOnce);
      });
    });
  });
</script>
</body>
</html>
