<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/web-socket/web-socket.html">

<link rel="import" href="../../src/behaviors/endpoints-behavior.html">

</head><body><dom-module id="check-connection">
  <template>
    <style>
      :host {
        display: none;
      }
    </style>

    <web-socket id="socket" url="[[endpoints.socket]]/config/platform/ping" on-open="_onOpen" on-close="_onClose" on-message="_onMessage" on-error="_onError" json=""></web-socket>
  </template>

  <script>"use strict";!function(){Polymer({is:"check-connection",behaviors:[Polymer.EndpointsBehaviorImp],properties:{lastTimestamp:{type:Number,notify:!1,value:0},connected:{type:Boolean,notify:!1,value:!0,observer:"connectedChanged"}},connectedChanged:function(e,t){e?document.querySelector("#globalErrMsg").hide():(document.querySelector("#globalErrMsg").label="Connection with Kazoup servers failed. Hold on, we are trying to reconnect..",document.querySelector("#globalErrMsg").show())},ready:function(){this.async(function(){console.log(this.$.socket.url),this.$.socket.open()},2e3)},_onOpen:function(e){},_onClose:function(e){clearTimeout(this.reconnectTimeout),this.reconnectTimeout=setTimeout(function(){this.$.socket.open()}.bind(this),2e3)},_onMessage:function(e){var t=JSON.parse(e.detail);this.set("lastTimestamp",t.timestamp),this.set("connected",!0),clearTimeout(this.timeout),this.timeout=setTimeout(function(){this.set("connected",!1)}.bind(this),3500)},_onError:function(e){}})}();</script>
</dom-module>
</body></html>